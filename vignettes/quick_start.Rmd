---
title: "Quick start guide"
description: >
  A minimal example for isotopocule data processing of an Orbitrap Iso file (.isox).
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quick start guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
library(isoorbi)

# Load a path to a system test file
file_path <-system.file("extdata", "testfile_Flow_Exploration_small.isox", package = "isoorbi")
```

A basic data processing example
```{r, echo=FALSE, message=FALSE}
# Read .isox test data
df <- orbi_read_isox(file_path) 

# Keep only most important columns; equivalent to simplify check box in IsoX
df.simple <- orbi_simplify_isox(dataset = df)

# Filter the data

df.filtered <- df.simple %>% 
                  orbi_filter_isox(filenames = "all",
                                   time_min = 0.1, 
                                   time_max = 1, 
                                   compounds = "HSO4-",
                                   isotopocules = c("M0", "34S", "33S", "17O", "18O"))

# Clean the data by removing noise and outliers
df.clean <- df.filtered %>% orbi_filter_satellite_peaks() %>% 
                            orbi_filter_weak_isotopocules(min_percent = 10) %>% 
                            orbi_filter_scan_intensity(truncate_extreme = 10)

# Define base peak and calculate the results table
df.results <- df.clean %>% orbi_define_basepeak(base_peak = "M0") %>% 
                              orbi_summarize_results(ratio_method = "sum")

```



```{r, include=FALSE, echo=FALSE, message=FALSE} 
#Temporary tests for optional grouping
df.simple$segment <- NA
df.simple$block <- NA
df.simple$injection <- NA
df.simple[df.simple$time.min <0.5,]$block <- "one"
df.simple[df.simple$time.min >0.5,]$block <- "two"
df.simple[df.simple$time.min <0.4,]$segment <- "one"
df.simple[df.simple$time.min >0.4,]$segment <- "twoo"
df.simple[df.simple$time.min <0.3,]$injection <- "onesy"
df.simple[df.simple$time.min >0.3,]$injection <- "2sy"
df.simple$block <- as.factor(df.simple$block)
df.simple$injection <- as.factor(df.simple$injection)
df.simple$segment <- as.factor(df.simple$segment)

```

